{"id":"wCTL","dependencies":[{"name":"D:\\DETROIT\\server\\tsconfig.json","includedInParent":true,"mtime":1660943058000},{"name":"D:\\DETROIT\\server\\.babelrc","includedInParent":true,"mtime":1660943058000},{"name":"D:\\DETROIT\\server\\package.json","includedInParent":true,"mtime":1697927911090},{"name":"react","loc":{"line":1,"column":33,"index":33},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.tsx","resolved":"D:\\DETROIT\\server\\node_modules\\react\\index.js"},{"name":"../../../../../modules/custom.event","loc":{"line":2,"column":28,"index":71},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\modules\\custom.event.ts"},{"name":"./spinner.less","loc":{"line":3,"column":7,"index":118},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.less"},{"name":"../../../../../modules/CEF","loc":{"line":4,"column":20,"index":157},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\modules\\CEF.ts"},{"name":"./../../assets/*.png","loc":{"line":5,"column":16,"index":204},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\assets\\*.png"},{"name":"./../../assets/items/*.png","loc":{"line":6,"column":22,"index":251},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\assets\\items\\*.png"},{"name":"../../donate-roulette","loc":{"line":7,"column":26,"index":308},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\donate-roulette.tsx"},{"name":"../../../../../../shared/donate/donate-roulette/main","loc":{"line":8,"column":35,"index":369},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.tsx","resolved":"D:\\DETROIT\\server\\src\\shared\\donate\\donate-roulette\\main.ts"},{"name":"./slot.js","loc":{"line":9,"column":17,"index":443},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\slot.js"},{"name":"./DropSlot","loc":{"line":10,"column":25,"index":482},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\spinner.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\components\\UserMenu\\components\\rulette\\spinner\\DropSlot.ts"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.SpinnerPage=void 0;var t=d(require(\"react\")),e=require(\"../../../../../modules/custom.event\");require(\"./spinner.less\");var a=require(\"../../../../../modules/CEF\"),i=l(require(\"./../../assets/*.png\")),n=l(require(\"./../../assets/items/*.png\")),r=require(\"../../donate-roulette\"),s=require(\"../../../../../../shared/donate/donate-roulette/main\"),o=l(require(\"./slot.js\")),u=require(\"./DropSlot\");function l(t){return t&&t.__esModule?t:{default:t}}function c(t){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap,a=new WeakMap;return(c=function(t){return t?a:e})(t)}function d(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||\"object\"!=typeof t&&\"function\"!=typeof t)return{default:t};var a=c(e);if(a&&a.has(t))return a.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if(\"default\"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var s=n?Object.getOwnPropertyDescriptor(t,r):null;s&&(s.get||s.set)?Object.defineProperty(i,r,s):i[r]=t[r]}return i.default=t,a&&a.set(t,i),i}function h(t){return(h=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,i)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?p(Object(a),!0).forEach(function(e){f(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function f(t,e,a){return(e=E(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function y(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function v(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,E(i.key),i)}}function b(t,e,a){return e&&v(t.prototype,e),a&&v(t,a),Object.defineProperty(t,\"prototype\",{writable:!1}),t}function E(t){var e=g(t,\"string\");return\"symbol\"===h(e)?e:String(e)}function g(t,e){if(\"object\"!==h(t)||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var i=a.call(t,e||\"default\");if(\"object\"!==h(i))return i;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return(\"string\"===e?String:Number)(t)}function w(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,\"prototype\",{writable:!1}),e&&S(t,e)}function S(t,e){return(S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function R(t){var e=P();return function(){var a,i=k(t);if(e){var n=k(this).constructor;a=Reflect.construct(i,arguments,n)}else a=i.apply(this,arguments);return C(this,a)}}function C(t,e){if(e&&(\"object\"===h(e)||\"function\"==typeof e))return e;if(void 0!==e)throw new TypeError(\"Derived constructors may only return object or undefined\");return O(t)}function O(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}function P(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var j=exports.SpinnerPage=function(l){w(d,t.Component);var c=R(d);function d(a){var i;return y(this,d),(i=c.call(this,a)).quantityPrizes=[{name:\"x1\",value:1,checked:!0},{name:\"x3\",value:3},{name:\"x5\",value:5}],i.state={dropItems:s.drops,withoutAnimation:!1,quantityPrizes:1,width:0,height:0,canvas:t.default.createRef(),parent:t.default.createRef(),ctx:null,countElements:9,speed:0,frameRate:36,maxSpeed:60,duration:2500,timeToStop:0,sizeItem:0,currentState:[],itemList:[],bgImg:null,lastFrame:0,headResult:null,winResult:null,winDrop:null,cancel:!1,antiFlood:0,stopFrom:0,sound:!0,winBuilded:!1,floodProtection:0,spinCost:i.props.type===r.ModalType.LUXE?1e3:i.props.type===r.ModalType.PREMIUM?500:i.props.type===r.ModalType.STANDART?200:null,isRun:!1,isStop:!1,isWin:!1,result:-1,audio:null},i.onChangeValue=i.onChangeValue.bind(O(i)),i.addWinElement=i.addWinElement.bind(O(i)),i.builWinCombination=i.builWinCombination.bind(O(i)),i.updateState=i.updateState.bind(O(i)),i.addRandomElement=i.addRandomElement.bind(O(i)),i.initGame=i.initGame.bind(O(i)),i.initImages=i.initImages.bind(O(i)),i.removeElement=i.removeElement.bind(O(i)),i.handleStop=i.handleStop.bind(O(i)),i.handleLoop=i.handleLoop.bind(O(i)),i.drawFrame=i.drawFrame.bind(O(i)),i.requestWin=i.requestWin.bind(O(i)),i.start=i.start.bind(O(i)),i.requestSpin=i.requestSpin.bind(O(i)),i.ev=e.CustomEvent.register(\"droulette:spin\",function(t){if(1==t.length)i.start(t[0]);else{for(var e=[],a=function(a){e.push(i.state.itemList.find(function(e){return e.data.dropId==t[a]}).data)},n=0;n<t.length;n++)a(n);i.props.spinFinished(e)}}),i}return b(d,[{key:\"onChangeValue\",value:function(t){this.setState({dropItems:s.drops,quantityPrizes:t.target.value,withoutAnimation:t.target.value>1||this.state.withoutAnimation})}},{key:\"componentDidMount\",value:function(){var t=this.state.parent.current,e=this.state.itemList;s.drops.filter(function(t){return t.rarity!==s.RarityType.CASINO}).forEach(function(t){e.push(new u.DropSlot(t))}),this.setState(m(m({},this.state),{},{itemList:e})),this.setState({ctx:this.state.canvas.current.getContext(\"2d\"),width:t.clientWidth,height:t.clientHeight,canvas:this.state.canvas,frameRate:Math.floor(1e3/this.state.frameRate)}),this.initImages(),setTimeout(this.initGame,500)}},{key:\"requestSpin\",value:function(){this.state.isRun||e.CustomEvent.triggerServer(\"droulette:request\",this.props.type,this.state.quantityPrizes)}},{key:\"start\",value:function(t){if(this.state.withoutAnimation){var e=this.state.itemList.find(function(e){return e.data.dropId==t});this.props.spinFinished([e.data])}else this.state.winBuilded||this.setState({winBuilded:!1,timeToStop:Date.now()+this.state.duration,isRun:!0,isStop:!1,isWin:!1,result:t})}},{key:\"addWinElement\",value:function(t){var e=this.state.currentState[this.state.currentState.length-1],a=e?e.posX+e.size:0,i=this.state.itemList.find(function(e){return e.data.dropId==t}),n=new o.default(this.state.ctx,i,this.state.parent.current.clientWidth/3,a);return this.state.currentState.push(n),this.setState({winDrop:i.data}),n}},{key:\"builWinCombination\",value:function(t){this.setState({winBuilded:!0});for(var e=0;e<this.state.countElements;e++)0==e?this.setState({headResult:this.addRandomElement()}):1==e?this.setState({winResult:this.addWinElement(t)}):this.addRandomElement()}},{key:\"componentWillUnmount\",value:function(){this.ev&&this.ev.destroy(),a.CEF.stopSound()}},{key:\"updateState\",value:function(){this.state.cancel||(this.state.lastFrame<Date.now()&&(this.state.isRun&&(this.setState({lastFrame:Date.now()+this.state.frameRate}),this.state.timeToStop<Date.now()&&this.setState({isStop:!0}),this.state.isStop?this.handleStop():this.handleLoop()),this.drawFrame()),requestAnimationFrame(this.updateState,this.state.canvas.current))}},{key:\"addRandomElement\",value:function(){var t=this.state.currentState[this.state.currentState.length-1],e=t?t.posX+t.size:0,a=this.state.itemList[Math.floor(Math.random()*this.state.itemList.length)],i=new o.default(this.state.ctx,a,this.state.parent.current.clientWidth/3,e);return this.state.currentState.push(i),i}},{key:\"initGame\",value:function(){this.setState({currentState:[]});for(var t=0;t<this.state.countElements+2;t++)this.addRandomElement();requestAnimationFrame(this.updateState,this.state.canvas)}},{key:\"initImages\",value:function(){var t=this;this.state.itemList.forEach(function(e){e.img=new Image(t.state.height,t.state.width),e.img.src=void 0===n.default[e.data.icon]?n.default[1]:n.default[e.data.icon],e.rarityImg=new Image(t.state.height,t.state.width),e.rarityImg.src=i.default[e.data.rarity===s.RarityType.LEGENDARY?\"gold\":e.data.rarity===s.RarityType.SPECIAL?\"red\":e.data.rarity===s.RarityType.UNIQUE?\"pink\":e.data.rarity===s.RarityType.RARE?\"purple\":e.data.rarity===s.RarityType.COMMON?\"blue\":\"red\"]})}},{key:\"removeElement\",value:function(){this.state.currentState.shift()}},{key:\"handleStop\",value:function(){var t=this;if(this.state.speed>.8*this.state.maxSpeed)this.state.currentState[0].canDelete()&&(this.removeElement(),this.addRandomElement()),this.state.currentState.forEach(function(e){e.moveX(t.state.speed)}),this.setState({speed:this.state.speed-1});else{this.state.winBuilded||(this.builWinCombination(this.state.result),this.setState({stopFrom:this.state.headResult.posX}));var e=Math.abs(this.state.headResult.posX/this.state.stopFrom);if(this.setState({speed:Math.max(Math.floor(this.state.maxSpeed*e*.75+3),5)}),this.state.headResult.posX<=0){var a=this.state.headResult.posX;this.state.currentState.forEach(function(t){t.fixPos(a)}),this.setState({speed:0}),this.requestWin()}else this.state.currentState.forEach(function(e){e.moveX(t.state.speed)});this.state.currentState[0].canDelete()&&this.removeElement()}}},{key:\"handleLoop\",value:function(){var t=this;this&&(this.state.maxSpeed>this.state.speed&&this.setState({speed:this.state.speed+5}),this.state.currentState[0].canDelete()&&(this.removeElement(),this.addRandomElement()),this.state.currentState.forEach(function(e){e.moveX(t.state.speed)}))}},{key:\"drawFrame\",value:function(){this.state.ctx.globalCompositeOperation=\"normal\",this.state.ctx.clearRect(0,0,this.state.width,this.state.height),this.state.currentState.forEach(function(t){t.draw()})}},{key:\"requestWin\",value:function(){var t=this;this.setState({isRun:!1,isStop:!1,isWin:!0,result:-1}),setTimeout(function(){t.props.spinFinished([t.state.winDrop])},100)}},{key:\"render\",value:function(){var e=this;return t.default.createElement(\"div\",{className:\"spinner-page \"+this.props.type},t.default.createElement(\"div\",{className:\"spinner-img-wrapper\"}),t.default.createElement(\"div\",{className:\"balance dark\"},t.default.createElement(\"div\",{className:\"coins\"},t.default.createElement(\"svg\",{width:\"22\",height:\"22\",className:\"coin-icon\",viewBox:\"0 0 22 22\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},t.default.createElement(\"path\",{fillRule:\"evenodd\",clipRule:\"evenodd\",d:\"M0 11C0 17.0751 4.92487 22 11 22C17.0751 22 22 17.0751 22 11C22 4.92487 17.0751 0 11 0C4.92487 0 0 4.92487 0 11ZM20 11C20 15.9706 15.9706 20 11 20C6.02944 20 2 15.9706 2 11C2 6.02944 6.02944 2 11 2C15.9706 2 20 6.02944 20 11ZM14 6C15.1046 6 16 6.89543 16 8V14C16 15.1046 15.1046 16 14 16H8C6.89543 16 6 15.1046 6 14V8C6 6.89543 6.89543 6 8 6H14ZM8 14V8H14V14H8Z\"})),t.default.createElement(\"span\",null,this.props.coins))),t.default.createElement(\"div\",{id:\"spinner-container\",className:\"spinner-wrapper\"},t.default.createElement(\"div\",{className:\"spinner-page-title\"},this.props.type,\" roulette\"),t.default.createElement(\"img\",{className:\"spinner-bg\",src:i.default[\"roulette-top-bg\"],alt:\"\"}),t.default.createElement(\"div\",{ref:this.state.parent,className:(this.state.isRun,\"spinner\")},t.default.createElement(\"div\",{className:this.state.isRun?\"pointer top move\":\"pointer top\"}),t.default.createElement(\"canvas\",{width:this.state.width,height:this.state.height,ref:this.state.canvas}),t.default.createElement(\"div\",{className:this.state.isRun?\"pointer bottom move\":\"pointer bottom\"})),t.default.createElement(\"div\",{className:\"spinner-controls\"},t.default.createElement(\"div\",{style:{display:\"flex\"}},t.default.createElement(\"div\",{className:\"quantity-prizes\",onChange:this.onChangeValue},this.quantityPrizes.map(function(a){return t.default.createElement(t.default.Fragment,null,t.default.createElement(\"input\",{type:\"radio\",id:a.name,value:a.value,name:\"q\",defaultChecked:a.value===e.state.quantityPrizes}),t.default.createElement(\"label\",{key:a.name,className:\"multiplier\",htmlFor:a.name},a.name))})),t.default.createElement(\"button\",{className:\"spinn\",onClick:this.requestSpin},\"Крутить за\",t.default.createElement(\"svg\",{width:\"18\",height:\"18\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},t.default.createElement(\"path\",{fillRule:\"evenodd\",clipRule:\"evenodd\",d:\"M0.75 9C0.75 13.5563 4.44365 17.25 9 17.25C13.5563 17.25 17.25 13.5563 17.25 9C17.25 4.44365 13.5563 0.75 9 0.75C4.44365 0.75 0.75 4.44365 0.75 9ZM15.75 9C15.75 12.7279 12.7279 15.75 8.99999 15.75C5.27207 15.75 2.24999 12.7279 2.24999 9C2.24999 5.27208 5.27207 2.25 8.99999 2.25C12.7279 2.25 15.75 5.27208 15.75 9ZM11.25 5.25C12.0784 5.25 12.75 5.92157 12.75 6.75V11.25C12.75 12.0784 12.0784 12.75 11.25 12.75H6.75C5.92157 12.75 5.25 12.0784 5.25 11.25V6.75C5.25 5.92157 5.92157 5.25 6.75 5.25H11.25ZM6.74999 11.25V6.75H11.25V11.25H6.74999Z\",fill:\"white\"})),this.state.quantityPrizes*this.state.spinCost)),t.default.createElement(\"div\",null,t.default.createElement(\"input\",{defaultChecked:this.state.withoutAnimation,checked:this.state.withoutAnimation,id:\"without-animation\",type:\"checkbox\",onChange:function(t){return e.setState({withoutAnimation:1==e.state.quantityPrizes?!e.state.withoutAnimation:e.state.withoutAnimation})}}),t.default.createElement(\"label\",{htmlFor:\"without-animation\"},t.default.createElement(\"div\",{className:\"checkbox\"},t.default.createElement(\"img\",{src:i.default.checkmark,alt:\"\"})),\"Быстрое открытие \",t.default.createElement(\"br\",null),\" \",t.default.createElement(\"small\",null,\"без анимации\"))))),t.default.createElement(\"div\",{className:\"dr-items-wrap\"},t.default.createElement(\"div\",{className:\"dr-roulette-items-title\"},\"Содержимое рулетки\"),t.default.createElement(\"div\",{className:\"dr-roulette-items\"},this.state.itemList.sort(function(t,e){return t.data.rarity<e.data.rarity?1:t.data.rarity>e.data.rarity?-1:0}).map(function(e){return t.default.createElement(\"div\",{className:\"dr-item \"+s.RarityType[e.data.rarity].toLowerCase()},t.default.createElement(\"img\",{className:\"item-rarity-img\",src:i.default[e.data.rarity===s.RarityType.LEGENDARY?\"gold\":e.data.rarity===s.RarityType.SPECIAL?\"red\":e.data.rarity===s.RarityType.UNIQUE?\"pink\":e.data.rarity===s.RarityType.RARE?\"purple\":e.data.rarity===s.RarityType.COMMON?\"blue\":null],alt:\"\"}),t.default.createElement(\"img\",{className:\"item-img\",src:n.default[e.data.icon],alt:\"\"}))}))))}}]),d}();"},"sourceMaps":null,"error":null,"hash":"4af7b5336f87f5a14afc3bf927168c9c","cacheData":{"env":{}}}