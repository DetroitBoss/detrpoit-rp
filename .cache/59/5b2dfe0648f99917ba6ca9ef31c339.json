{"id":"FPfd","dependencies":[{"name":"C:\\onyx_V2\\server\\tsconfig.json","includedInParent":true,"mtime":1660943058000},{"name":"C:\\onyx_V2\\server\\.babelrc","includedInParent":true,"mtime":1660943058000},{"name":"C:\\onyx_V2\\server\\package.json","includedInParent":true,"mtime":1697927911090},{"name":"./style.less","loc":{"line":1,"column":7,"index":7},"parent":"C:\\onyx_V2\\server\\src\\cef\\components\\HudBlock\\chat.tsx","resolved":"C:\\onyx_V2\\server\\src\\cef\\components\\HudBlock\\style.less"},{"name":"react","loc":{"line":2,"column":44,"index":68},"parent":"C:\\onyx_V2\\server\\src\\cef\\components\\HudBlock\\chat.tsx","resolved":"C:\\onyx_V2\\server\\node_modules\\react\\index.js"},{"name":"./images/svg/*.svg","loc":{"line":3,"column":17,"index":95},"parent":"C:\\onyx_V2\\server\\src\\cef\\components\\HudBlock\\chat.tsx","resolved":"C:\\onyx_V2\\server\\src\\cef\\components\\HudBlock\\images\\svg\\*.svg"},{"name":"../../modules/custom.event","loc":{"line":4,"column":28,"index":146},"parent":"C:\\onyx_V2\\server\\src\\cef\\components\\HudBlock\\chat.tsx","resolved":"C:\\onyx_V2\\server\\src\\cef\\modules\\custom.event.ts"},{"name":"../../modules/CEF","loc":{"line":5,"column":20,"index":197},"parent":"C:\\onyx_V2\\server\\src\\cef\\components\\HudBlock\\chat.tsx","resolved":"C:\\onyx_V2\\server\\src\\cef\\modules\\CEF.ts"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.HudChatClass=void 0,require(\"./style.less\");var t=o(require(\"react\")),e=a(require(\"./images/svg/*.svg\")),n=require(\"../../modules/custom.event\"),r=require(\"../../modules/CEF\");function a(t){return t&&t.__esModule?t:{default:t}}function i(t){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(i=function(t){return t?n:e})(t)}function o(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||\"object\"!=typeof t&&\"function\"!=typeof t)return{default:t};var n=i(e);if(n&&n.has(t))return n.get(t);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(\"default\"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=a?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,n&&n.set(t,r),r}function s(t){return(s=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}function u(t){return h(t)||f(t)||l(t)||c()}function c(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function l(t,e){if(t){if(\"string\"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return\"Object\"===n&&t.constructor&&(n=t.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(t):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}function f(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}function h(t){if(Array.isArray(t))return d(t)}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function m(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(t,v(r.key),r)}}function y(t,e,n){return e&&p(t.prototype,e),n&&p(t,n),Object.defineProperty(t,\"prototype\",{writable:!1}),t}function v(t){var e=g(t,\"string\");return\"symbol\"===s(e)?e:String(e)}function g(t,e){if(\"object\"!==s(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||\"default\");if(\"object\"!==s(r))return r;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return(\"string\"===e?String:Number)(t)}function b(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,\"prototype\",{writable:!1}),e&&w(t,e)}function w(t,e){return(w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function C(t){var e=S();return function(){var n,r=O(t);if(e){var a=O(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return k(this,n)}}function k(t,e){if(e&&(\"object\"===s(e)||\"function\"==typeof e))return e;if(void 0!==e)throw new TypeError(\"Derived constructors may only return object or undefined\");return E(t)}function E(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}function S(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var I=exports.HudChatClass=function(a){b(o,t.Component);var i=C(o);function o(e){var a;if(m(this,o),(a=i.call(this,e)).commands=[[\"me\",\"/me\",\"Опишите состояние\"],[\"do\",\"/do\",\"Опишите состояние\"],[\"try\",\"/try\",\"Опишите предмет случайности\"],[\"b\",\"OOC чат\",\"Напишите сообщение\"]],a.state={fullshowtimer:0,input:\"\",messages:[],history:[],historyIndex:0,currentTime:\"00:00\",active:!1,show:!0,showHud:!1,enable:!0},n.CustomEvent.register(\"cef:hud:showHud\",function(t){a.setState({showHud:t},function(){t&&a.messagesBlock&&a.messagesBlock.current&&a.messagesBlock.current.scrollTo({top:a.messagesBlock.current.scrollHeight})})}),a.messagesBlock=(0,t.createRef)(),window.chatAPI||(Object.defineProperty(window,\"chatAPI\",{writable:!0}),window.chatAPI={}),n.CustomEvent.register(\"outputChatBox\",function(t){window.chatAPI.push(t)}),n.CustomEvent.register(\"hud:data\",function(t,e,n,r,i){a.setState({currentTime:e})}),n.CustomEvent.register(\"alerts:enable\",function(t){a.setState({enable:t.enableChat})}),setInterval(function(){a.state.fullshowtimer&&a.setState({fullshowtimer:a.state.fullshowtimer-1})},1e3),window.chatAPI.push=a.insertMessage.bind(E(a)),window.chatAPI.clear=a.clearChat.bind(E(a)),window.chatAPI.show=a.showChat.bind(E(a)),window.chatAPI.activate=a.activeInput.bind(E(a)),window.chatAPI.send=a.sendMessage.bind(E(a)),window.chatAPI.value=a.valueInput.bind(E(a)),r.CEF.test){var s=0;a.int=setInterval(function(){s++,a.insertMessage(\"Случайное сообщение которое СлучайноесообщениекотороеСлучайноесообщениекотороеСлучайноесообщениекотороСлучайноесообщениекоторое  \"+s,\"Дядя Петя\")},300)}return n.CustomEvent.register(\"cef:chat:message\",function(t){a.insertMessage(t)}),n.CustomEvent.register(\"hud:pubg\",function(){a.setState({inpubg:!0})}),n.CustomEvent.register(\"hud:pubghide\",function(){a.setState({inpubg:!1})}),a}return y(o,[{key:\"valueInput\",value:function(t){this.setState({input:t})}},{key:\"clearChat\",value:function(){this.setState({messages:[]})}},{key:\"showChat\",value:function(t){this.setState({show:t})}},{key:\"sendMessage\",value:function(){var t=this.state.input;if(!((t=t.trim()).length>=350)){if(t.length>0)if(\"/\"===t[0]){if((t=t.substr(1)).length>0){var e=t.split(\" \");e.length>=1&&r.CEF.triggerChatCommand.apply(r.CEF,u(e)),this.setState({history:[\"/\"+t].concat(u(this.state.history))})}}else mp.trigger(\"chatMessage\",t),this.setState({history:[t].concat(u(this.state.history))});this.valueInput(\"\")}}},{key:\"activeInput\",value:function(t){mp.trigger(\"setChatActiveInput\",!!t),mp.trigger(\"cef:setCursor\",t),this.state.active!==t&&mp.invoke(\"focus\",t),this.setState({active:t})}},{key:\"insertMessage\",value:function(t,e){var n=this,r=u(this.state.messages),a=this.messagesBlock&&this.messagesBlock.current&&this.messagesBlock.current.scrollHeight==this.messagesBlock.current.scrollTop+this.messagesBlock.current.clientHeight;r.push([this.state.currentTime,e,t]),this.setState({messages:r,fullshowtimer:20},function(){a&&n.messagesBlock.current.scrollTo({top:n.messagesBlock.current.scrollHeight})})}},{key:\"handleKeyDown\",value:function(t){if(this.state.showHud&&(!r.CEF.gui.currentGui||\"hud\"==r.CEF.gui.currentGui||\"init\"==r.CEF.gui.currentGui))return r.CEF.focusInput||this.state.active||!this.state.showHud||84!=t.keyCode?void(this.state.active&&[13,27].includes(t.keyCode)&&this.state.active&&(t.preventDefault(),this.sendMessage(),this.activeInput(!1))):(t.preventDefault(),void this.activeInput(!0))}},{key:\"componentDidMount\",value:function(){var t=this;document.addEventListener(\"keydown\",function(e){t.handleKeyDown(e)})}},{key:\"componentWillUnmount\",value:function(){var t=this;document.removeEventListener(\"keydown\",function(e){t.handleKeyDown(e)}),this.int&&clearInterval(this.int)}},{key:\"currentCommand\",get:function(){return this.getStringCommand(this.state.input)}},{key:\"getStringCommand\",value:function(t){if(!t)return null;var e=null;return this.commands.map(function(n){0===t.indexOf(\"/\"+n[0]+\" \")&&(e=n[0])}),e}},{key:\"formatMessage\",value:function(t){t=(t=unescape(t)).replace(/\\n/g,\" \");var e={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\",\"/\":\"&#x2F;\",\"`\":\"&#x60;\",\"=\":\"&#x3D;\"},n=String(t).replace(/[&<>\"'`=\\/]/gi,function(t){return e[t]}).split(\"\").reduce(function(t,e){return t+(/[a-zA-z0-9а-яА-ЯЁё\\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\{\\}\\,\\.\\/\\_\\+\\№\\;\\:\\?\\\\\\<\\>\\`\\-]/gi.test(e)?e:\" \")},\"\"),r=/!\\{#\\w*\\}/gi,a=n.match(r);if(null!==a){for(var i=0;i<a.length;i++){var o=a[i].replace(a[i],a[i].replace(\"!{\",\"\").replace(\"}\",\"\"));n=n.replace(a[i],'<span style=\"color: '+o+'\">')}for(var s=0;s<a.length;s++)n+=\"</span>\"}if(r=/!\\{\\w*\\}/gi,null!==(a=n.match(r))){for(var u=0;u<a.length;u++){var c=a[u].replace(a[u],a[u].replace(\"!{\",\"\").replace(\"}\",\"\"));n=n.replace(a[u],'<span style=\"color: #'+c+'\">')}for(var l=0;l<a.length;l++)n+=\"</span>\"}return n}},{key:\"currentCommandDesc\",get:function(){var t=this;if(!this.state.input)return\"Напишите сообщение\";var e=\"Напишите сообщение\";return this.commands.map(function(n){0===t.state.input.indexOf(\"/\"+n[0]+\" \")&&(e=n[2])}),e}},{key:\"clearCommand\",value:function(t){var e=this.state.input;this.commands.map(function(t){0===e.indexOf(\"/\"+t[0]+\" \")&&(e=e.replace(\"/\"+t[0]+\" \",\"\"))}),this.setState({input:e},function(){t&&t(e)})}},{key:\"setCommand\",value:function(t){var e=this;this.clearCommand(function(n){e.setState({input:\"/\".concat(t,\" \").concat(n)})})}},{key:\"render\",value:function(){var n=this;return this.state.show&&this.state.showHud&&this.state.enable?t.default.createElement(\"div\",{className:\"hud-chat \"+(this.state.inpubg?\"battle-royal\":\"\"),style:{opacity:this.state.fullshowtimer||this.state.active||!this.props.alertsData||!this.props.alertsData.opacityChat?1:.1},tabIndex:-1},t.default.createElement(\"div\",{className:\"hud-chat-history-wrap\",ref:this.messagesBlock,tabIndex:-1},this.state.messages.map(function(e,r){return t.default.createElement(\"div\",{className:\"hud-chat-history-item\",key:\"message_chat_\".concat(r)},t.default.createElement(\"p\",{className:\"name\"},e[1]?\"\".concat(e[1],\":\"):\"\"),t.default.createElement(\"p\",{className:\"message\",dangerouslySetInnerHTML:{__html:n.formatMessage(e[2])}}))})),this.state.active?t.default.createElement(t.default.Fragment,null,t.default.createElement(\"div\",{className:\"hud-write-message\"},t.default.createElement(\"input\",{type:\"text\",placeholder:this.currentCommandDesc+\" . . .\",value:this.state.input,onChange:function(t){t.preventDefault(),n.setState({input:t.currentTarget.value,historyIndex:-1})},onKeyDown:function(t){if(38===t.keyCode||40===t.keyCode){var e=38===t.keyCode?n.state.historyIndex+1:n.state.historyIndex-1;n.state.history[e]&&(n.setState({input:n.state.history[e],historyIndex:e}),t.preventDefault())}},ref:function(t){t&&t.focus()}}),t.default.createElement(\"button\",{className:\"send-wrap\",onClick:function(t){t.preventDefault(),n.sendMessage()}},t.default.createElement(\"img\",{src:e.default.send,width:\"24\",height:\"24\"}))),t.default.createElement(\"div\",{className:\"hud-extra-radiobutton-wrap\"},t.default.createElement(\"div\",{className:\"hud-extra-radiobutton-item\",onClick:function(t){t.preventDefault(),n.clearCommand()}},t.default.createElement(\"input\",{type:\"radio\",id:\"extra1\",name:\"extra-radio\",readOnly:!0,checked:!this.currentCommand}),t.default.createElement(\"label\",{htmlFor:\"extra1\"},\"Общий чат\")),this.commands.map(function(e){return t.default.createElement(\"div\",{className:\"hud-extra-radiobutton-item\",key:\"type_chat_\".concat(e[0]),onClick:function(t){t.preventDefault(),n.setCommand(e[0])}},t.default.createElement(\"input\",{type:\"radio\",id:\"extra1\",name:\"extra-radio\",readOnly:!0,checked:n.currentCommand===e[0]}),t.default.createElement(\"label\",{htmlFor:\"extra1\"},e[1]))}))):t.default.createElement(t.default.Fragment,null)):t.default.createElement(t.default.Fragment,null)}}]),o}();"},"sourceMaps":null,"error":null,"hash":"33ed6afbd84be96eaf16e0e55c1f2c73","cacheData":{"env":{}}}