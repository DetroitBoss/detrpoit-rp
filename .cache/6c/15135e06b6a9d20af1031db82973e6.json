{"id":"FPfd","dependencies":[{"name":"D:\\DETROIT\\server\\tsconfig.json","includedInParent":true,"mtime":1660943058000},{"name":"D:\\DETROIT\\server\\.babelrc","includedInParent":true,"mtime":1660943058000},{"name":"D:\\DETROIT\\server\\package.json","includedInParent":true,"mtime":1697927911090},{"name":"./style.less","loc":{"line":1,"column":7,"index":7},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\HudBlock\\chat.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\components\\HudBlock\\style.less"},{"name":"react","loc":{"line":2,"column":44,"index":68},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\HudBlock\\chat.tsx","resolved":"D:\\DETROIT\\server\\node_modules\\react\\index.js"},{"name":"./images/svg/*.svg","loc":{"line":3,"column":17,"index":95},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\HudBlock\\chat.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\components\\HudBlock\\images\\svg\\*.svg"},{"name":"../../modules/custom.event","loc":{"line":4,"column":28,"index":146},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\HudBlock\\chat.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\modules\\custom.event.ts"},{"name":"../../modules/CEF","loc":{"line":5,"column":20,"index":197},"parent":"D:\\DETROIT\\server\\src\\cef\\components\\HudBlock\\chat.tsx","resolved":"D:\\DETROIT\\server\\src\\cef\\modules\\CEF.ts"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.HudChatClass=void 0,require(\"./style.less\");var e=o(require(\"react\")),t=a(require(\"./images/svg/*.svg\")),n=require(\"../../modules/custom.event\"),r=require(\"../../modules/CEF\");function a(e){return e&&e.__esModule?e:{default:e}}function i(e){if(\"function\"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||\"object\"!=typeof e&&\"function\"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(\"default\"!==o&&{}.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function s(e){return(s=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function u(e){return h(e)||f(e)||l(e)||c()}function c(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function l(e,t){if(e){if(\"string\"==typeof e)return d(e,t);var n={}.toString.call(e).slice(8,-1);return\"Object\"===n&&e.constructor&&(n=e.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(e):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function f(e){if(\"undefined\"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e[\"@@iterator\"])return Array.from(e)}function h(e){if(Array.isArray(e))return d(e)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,v(r.key),r)}}function y(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),Object.defineProperty(e,\"prototype\",{writable:!1}),e}function v(e){var t=g(e,\"string\");return\"symbol\"==s(t)?t:t+\"\"}function g(e,t){if(\"object\"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||\"default\");if(\"object\"!=s(r))return r;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return(\"string\"===t?String:Number)(e)}function b(e,t,n){return t=E(t),w(e,k()?Reflect.construct(t,n||[],E(e).constructor):t.apply(e,n))}function w(e,t){if(t&&(\"object\"==s(t)||\"function\"==typeof t))return t;if(void 0!==t)throw new TypeError(\"Derived constructors may only return object or undefined\");return C(e)}function C(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function k(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(k=function(){return!!e})()}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,\"prototype\",{writable:!1}),t&&I(e,t)}function I(e,t){return(I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var O=exports.HudChatClass=function(a){function i(t){var a;if(m(this,i),(a=b(this,i,[t])).commands=[[\"me\",\"/me\",\"Опишите состояние\"],[\"do\",\"/do\",\"Опишите состояние\"],[\"try\",\"/try\",\"Опишите предмет случайности\"],[\"b\",\"OOC чат\",\"Напишите сообщение\"]],a.state={fullshowtimer:0,input:\"\",messages:[],history:[],historyIndex:0,currentTime:\"00:00\",active:!0,show:!0,showHud:!0,enable:!0},n.CustomEvent.register(\"cef:hud:showHud\",function(e){a.setState({showHud:e},function(){e&&a.messagesBlock&&a.messagesBlock.current&&a.messagesBlock.current.scrollTo({top:a.messagesBlock.current.scrollHeight})})}),a.messagesBlock=(0,e.createRef)(),window.chatAPI||(Object.defineProperty(window,\"chatAPI\",{writable:!0}),window.chatAPI={}),n.CustomEvent.register(\"outputChatBox\",function(e){window.chatAPI.push(e)}),n.CustomEvent.register(\"hud:data\",function(e,t,n,r,i){a.setState({currentTime:t})}),n.CustomEvent.register(\"alerts:enable\",function(e){a.setState({enable:e.enableChat})}),setInterval(function(){a.state.fullshowtimer&&a.setState({fullshowtimer:a.state.fullshowtimer-1})},1e3),window.chatAPI.push=a.insertMessage.bind(a),window.chatAPI.clear=a.clearChat.bind(a),window.chatAPI.show=a.showChat.bind(a),window.chatAPI.activate=a.activeInput.bind(a),window.chatAPI.send=a.sendMessage.bind(a),window.chatAPI.value=a.valueInput.bind(a),r.CEF.test){var o=0;a.int=setInterval(function(){o++,a.insertMessage(\"Случайное сообщение которое СлучайноесообщениекотороеСлучайноесообщениекотороеСлучайноесообщениекотороСлучайноесообщениекоторое  \"+o,\"Дядя Петя\")},300)}return n.CustomEvent.register(\"cef:chat:message\",function(e){a.insertMessage(e)}),n.CustomEvent.register(\"hud:pubg\",function(){a.setState({inpubg:!0})}),n.CustomEvent.register(\"hud:pubghide\",function(){a.setState({inpubg:!1})}),a}return S(i,e.Component),y(i,[{key:\"valueInput\",value:function(e){this.setState({input:e})}},{key:\"clearChat\",value:function(){this.setState({messages:[]})}},{key:\"showChat\",value:function(e){this.setState({show:e})}},{key:\"sendMessage\",value:function(){var e=this.state.input;if(!((e=e.trim()).length>=350)){if(e.length>0)if(\"/\"===e[0]){if((e=e.substr(1)).length>0){var t=e.split(\" \");t.length>=1&&r.CEF.triggerChatCommand.apply(r.CEF,u(t)),this.setState({history:[\"/\"+e].concat(u(this.state.history))})}}else mp.trigger(\"chatMessage\",e),this.setState({history:[e].concat(u(this.state.history))});this.valueInput(\"\")}}},{key:\"activeInput\",value:function(e){mp.trigger(\"setChatActiveInput\",!!e),mp.trigger(\"cef:setCursor\",e),this.state.active!==e&&mp.invoke(\"focus\",e),this.setState({active:e})}},{key:\"insertMessage\",value:function(e,t){var n=this,r=u(this.state.messages),a=this.messagesBlock&&this.messagesBlock.current&&this.messagesBlock.current.scrollHeight==this.messagesBlock.current.scrollTop+this.messagesBlock.current.clientHeight;r.push([this.state.currentTime,t,e]),this.setState({messages:r,fullshowtimer:20},function(){a&&n.messagesBlock.current.scrollTo({top:n.messagesBlock.current.scrollHeight})})}},{key:\"handleKeyDown\",value:function(e){if(this.state.showHud&&(!r.CEF.gui.currentGui||\"hud\"==r.CEF.gui.currentGui||\"init\"==r.CEF.gui.currentGui))return r.CEF.focusInput||this.state.active||!this.state.showHud||84!=e.keyCode?void(this.state.active&&[13,27].includes(e.keyCode)&&this.state.active&&(e.preventDefault(),this.sendMessage(),this.activeInput(!1))):(e.preventDefault(),void this.activeInput(!0))}},{key:\"componentDidMount\",value:function(){var e=this;document.addEventListener(\"keydown\",function(t){e.handleKeyDown(t)})}},{key:\"componentWillUnmount\",value:function(){var e=this;document.removeEventListener(\"keydown\",function(t){e.handleKeyDown(t)}),this.int&&clearInterval(this.int)}},{key:\"currentCommand\",get:function(){return this.getStringCommand(this.state.input)}},{key:\"getStringCommand\",value:function(e){if(!e)return null;var t=null;return this.commands.map(function(n){0===e.indexOf(\"/\"+n[0]+\" \")&&(t=n[0])}),t}},{key:\"formatMessage\",value:function(e){e=(e=unescape(e)).replace(/\\n/g,\" \");var t={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\",\"/\":\"&#x2F;\",\"`\":\"&#x60;\",\"=\":\"&#x3D;\"},n=String(e).replace(/[&<>\"'`=\\/]/gi,function(e){return t[e]}).split(\"\").reduce(function(e,t){return e+(/[a-zA-z0-9а-яА-ЯЁё\\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\{\\}\\,\\.\\/\\_\\+\\№\\;\\:\\?\\\\\\<\\>\\`\\-]/gi.test(t)?t:\" \")},\"\"),r=/!\\{#\\w*\\}/gi,a=n.match(r);if(null!==a){for(var i=0;i<a.length;i++){var o=a[i].replace(a[i],a[i].replace(\"!{\",\"\").replace(\"}\",\"\"));n=n.replace(a[i],'<span style=\"color: '+o+'\">')}for(var s=0;s<a.length;s++)n+=\"</span>\"}if(r=/!\\{\\w*\\}/gi,null!==(a=n.match(r))){for(var u=0;u<a.length;u++){var c=a[u].replace(a[u],a[u].replace(\"!{\",\"\").replace(\"}\",\"\"));n=n.replace(a[u],'<span style=\"color: #'+c+'\">')}for(var l=0;l<a.length;l++)n+=\"</span>\"}return n}},{key:\"currentCommandDesc\",get:function(){var e=this;if(!this.state.input)return\"Напишите сообщение\";var t=\"Напишите сообщение\";return this.commands.map(function(n){0===e.state.input.indexOf(\"/\"+n[0]+\" \")&&(t=n[2])}),t}},{key:\"clearCommand\",value:function(e){var t=this.state.input;this.commands.map(function(e){0===t.indexOf(\"/\"+e[0]+\" \")&&(t=t.replace(\"/\"+e[0]+\" \",\"\"))}),this.setState({input:t},function(){e&&e(t)})}},{key:\"setCommand\",value:function(e){var t=this;this.clearCommand(function(n){t.setState({input:\"/\".concat(e,\" \").concat(n)})})}},{key:\"render\",value:function(){var n=this;return this.state.show&&this.state.showHud&&this.state.enable?e.default.createElement(\"div\",{className:\"hud-chat \"+(this.state.inpubg?\"battle-royal\":\"\"),style:{opacity:this.state.fullshowtimer||this.state.active||!this.props.alertsData||!this.props.alertsData.opacityChat?1:.1},tabIndex:-1},e.default.createElement(\"div\",{className:\"hud-chat-history-wrap\",ref:this.messagesBlock,tabIndex:-1},this.state.messages.map(function(t,r){return e.default.createElement(\"div\",{className:\"hud-chat-history-item\",key:\"message_chat_\".concat(r)},e.default.createElement(\"p\",{className:\"name\"},t[1]?\"\".concat(t[1],\":\"):\"\"),e.default.createElement(\"p\",{className:\"message\",dangerouslySetInnerHTML:{__html:n.formatMessage(t[2])}}))})),this.state.active?e.default.createElement(e.default.Fragment,null,e.default.createElement(\"div\",{className:\"hud-write-message\"},e.default.createElement(\"input\",{type:\"text\",placeholder:this.currentCommandDesc+\" . . .\",value:this.state.input,onChange:function(e){e.preventDefault(),n.setState({input:e.currentTarget.value,historyIndex:-1})},onKeyDown:function(e){if(38===e.keyCode||40===e.keyCode){var t=38===e.keyCode?n.state.historyIndex+1:n.state.historyIndex-1;n.state.history[t]&&(n.setState({input:n.state.history[t],historyIndex:t}),e.preventDefault())}},ref:function(e){e&&e.focus()}}),e.default.createElement(\"button\",{className:\"send-wrap\",onClick:function(e){e.preventDefault(),n.sendMessage()}},e.default.createElement(\"img\",{src:t.default.send,width:\"24\",height:\"24\"}))),e.default.createElement(\"div\",{className:\"hud-extra-radiobutton-wrap\"},e.default.createElement(\"div\",{className:\"hud-extra-radiobutton-item\",onClick:function(e){e.preventDefault(),n.clearCommand()}},e.default.createElement(\"input\",{type:\"radio\",id:\"extra1\",name:\"extra-radio\",readOnly:!0,checked:!this.currentCommand}),e.default.createElement(\"label\",{htmlFor:\"extra1\"},\"Общий чат\")),this.commands.map(function(t){return e.default.createElement(\"div\",{className:\"hud-extra-radiobutton-item\",key:\"type_chat_\".concat(t[0]),onClick:function(e){e.preventDefault(),n.setCommand(t[0])}},e.default.createElement(\"input\",{type:\"radio\",id:\"extra1\",name:\"extra-radio\",readOnly:!0,checked:n.currentCommand===t[0]}),e.default.createElement(\"label\",{htmlFor:\"extra1\"},t[1]))}))):e.default.createElement(e.default.Fragment,null)):e.default.createElement(e.default.Fragment,null)}}])}();"},"sourceMaps":null,"error":null,"hash":"2672a5d8af9543090258c134018504ce","cacheData":{"env":{}}}